<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/CaseOpening/CaseOpening.css">
    <link rel="stylesheet" href="css/PerfilPhoto/PerfilPhoto.css">
    <title>Document</title>
</head>

<body>

    <section class="PerfilPhoto">

        <div class="navigation">

            <img src="assets/images/Personagens/romanov.png" alt="">

            <h2>Seja bem vindo <br> <b id="b_usuario">Nome</b></h2>

            <ul>
                <li class="list">
                    <a href="CaseOpening.html">
                        <span class="icon">
                            <ion-icon name="home-outline"></ion-icon>
                        </span>
                        <span class="title">Game Space</span>
                    </a>
                </li>

                <li class="list active">
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="person-circle-outline"></ion-icon>
                        </span>
                        <span class="title">Foto de Perfil</span>
                    </a>
                </li>

                <li class="list">
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="analytics-outline"></ion-icon>
                        </span>
                        <span class="title">Estatísticas</span>
                    </a>
                </li>

                <li class="list">
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="settings-outline"></ion-icon>
                        </span>
                        <span class="title">Configurações</span>
                    </a>
                </li>

                <li class="list">
                    <a href="#">
                        <span class="icon">
                            <ion-icon name="help-circle-outline"></ion-icon>
                        </span>
                        <span class="title">Ajudar</span>
                    </a>
                </li>

                <li class="list">
                    <a href="index.html">
                        <span class="icon">
                            <ion-icon name="log-out-outline"></ion-icon>
                        </span>
                        <span class="title">Sair</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="container-perfil">
            <h1>ESCOLHA UMA FOTO DE PERFIL</h1>
            <div class="container-images">
                <div class="images-container">
                    <img src="assets/images/Personagens/ava.png" alt="">
                    <h2><input id="ava" type="checkbox" value="1">Ava</h2>
                </div>
                <div class="images-container">
                    <img src="assets/images/Personagens/blackwolf.png" alt="">
                    <h2><input id="blackwolf" type="checkbox" value="2">Black Wolf</h2>
                </div>
                <div class="images-container">
                    <img src="assets/images/Personagens/rezan.png" alt="">
                    <h2><input id="rezan" type="checkbox" value="3">Rezan</h2>
                </div>
                <div class="images-container">
                    <img src="assets/images/Personagens/romanov.png" alt="">
                    <h2><input id="romanov" type="checkbox" value="4">Romanov</h2>
                </div>
                <div class="images-container">
                    <img src="assets/images/Personagens/slingshot.png" alt="">
                    <h2><input id="slingshot" type="checkbox" value="5">Slingshot</h2>
                </div>
            </div>
            <button onclick="cadastrar()">Confirmar alteração</button>
        </div>
    </section>

    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="js/CaseOpening.js"></script>

</body>

</html>

<script>

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    var idImagem 

    function cadastrar() {
        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        
        // var ava = ava.value;
        // var blackwolf = blackwolf.value;
        // var rezan = rezan.value;
        // var romanov = romanov.value;
        // var slingshot = slingshot.value;

        if (ava.checked) {
            idImagem = 1
        } else if (blackwolf.checked) {
            idImagem = blackwolf
        } else if (rezan.checked) {
            idImagem = rezan
        } else if (romanov.checked) {
            idImagem = romanov
        } else if (slingshot.checked) {
            idImagem = slingshot
        }

        var idUsuario = sessionStorage.getItem('ID_USUARIO')
        

        // Enviando o valor da nova input
        // DANDO PROBLEMA 
        fetch("/usuarios/cadastrarImagem", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                idUsuario: idUsuario,
                idImagem: idImagem
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                alert("Inserimos")
                // Recuperando a imagem que o usuário escolheu
                sessionStorage.setItem('fkImagem', `${idImagem}`)
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;
    }


</script>